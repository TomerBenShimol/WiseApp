<div>
  <section>
    <h1>AI-Powered WhatsApp Lessons</h1>
    <p>
      Get personalized AI-generated lessons delivered to your WhatsApp. Choose
      your topic, frequency, and schedule.
    </p>
  </section>
  <form (submit)="onSubmit($event)">
    <mat-form-field appearance="outline">
      <mat-label>Phone Number</mat-label>
      <input
        matInput
        [formField]="configurationForm.phoneNumber"
        placeholder="Enter your WhatsApp phone number"
        type="tel"
      />
      @if (
        configurationForm.phoneNumber().touched() &&
        !configurationForm.phoneNumber().valid()
      ) {
        @for (error of configurationForm.phoneNumber().errors(); track error) {
          <mat-error>{{ error.message }}</mat-error>
        }
      }
    </mat-form-field>

    <mat-form-field appearance="outline">
      <mat-label>Learning Topic</mat-label>
      <input
        matInput
        [formField]="configurationForm.topic"
        [matAutocomplete]="topicAuto"
        placeholder="Choose or type a topic"
      />
      <mat-autocomplete #topicAuto="matAutocomplete">
        @for (topic of filteredTopics(); track topic) {
          <mat-option [value]="topic">
            {{ topic }}
          </mat-option>
        }
      </mat-autocomplete>
      @if (
        configurationForm.topic().touched() &&
        !configurationForm.topic().valid()
      ) {
        @for (error of configurationForm.topic().errors(); track error) {
          <mat-error>{{ error.message }}</mat-error>
        }
      }
    </mat-form-field>

    <mat-form-field appearance="outline">
      <mat-label>Number of Messages</mat-label>
      <mat-select [formField]="configurationForm.messageCount">
        @for (count of messageCountOptions; track count) {
          <mat-option [value]="count">
            {{ count }} message{{ count > 1 ? "s" : "" }}
          </mat-option>
        }
      </mat-select>
      @if (
        configurationForm.messageCount().touched() &&
        !configurationForm.messageCount().valid()
      ) {
        @for (error of configurationForm.messageCount().errors(); track error) {
          <mat-error>{{ error.message }}</mat-error>
        }
      }
    </mat-form-field>

    <fieldset>
      <legend>Select Days for Delivery</legend>
      <div>
        @for (day of weekdays; track day) {
          <mat-checkbox
            [formField]="configurationForm.selectedDays"
            [checked]="isDaySelected(day.value)"
            (change)="onDayChange(day.value, $event)"
          >
            {{ day.label }}
          </mat-checkbox>
        }
      </div>
      @if (
        configurationForm.selectedDays().touched() &&
        !configurationForm.selectedDays().valid()
      ) {
        @for (error of configurationForm.selectedDays().errors(); track error) {
          <mat-error>{{ error.message }}</mat-error>
        }
      }
    </fieldset>

    <mat-form-field appearance="outline">
      <mat-label>Delivery Time (24-hour format)</mat-label>
      <input
        matInput
        [formField]="configurationForm.deliveryTime"
        [matTimepicker]="timePicker"
        placeholder="HH:mm"
      />
      <mat-timepicker #timePicker></mat-timepicker>
      @if (
        configurationForm.deliveryTime().touched() &&
        !configurationForm.deliveryTime().valid()
      ) {
        @for (error of configurationForm.deliveryTime().errors(); track error) {
          <mat-error>{{ error.message }}</mat-error>
        }
      }
    </mat-form-field>

    <button
      mat-raised-button
      type="submit"
      [disabled]="!configurationForm().valid()"
    >
      Start Learning
    </button>
  </form>
</div>
